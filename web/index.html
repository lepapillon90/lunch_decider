<!DOCTYPE html>
<html>
<head>
  <!--
    If you are serving your web app in a path other than the root, change the
    href value below to reflect the base path you are serving from.

    The path provided below has to start and end with a slash "/" in order for
    it to work correctly.

    For more details:
    * https://developer.mozilla.org/en-US/docs/Web/HTML/Element/base

    This is a placeholder for base href that will be replaced by the value of
    the `--base-href` argument provided to `flutter build`.
  -->
  <base href="$FLUTTER_BASE_HREF">

  <meta charset="UTF-8">
  <meta content="IE=Edge" http-equiv="X-UA-Compatible">
  <meta name="description" content="A new Flutter project.">

  <!-- iOS meta tags & icons -->
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <meta name="apple-mobile-web-app-title" content="점심결정사">
  <link rel="apple-touch-icon" href="icons/Icon-192.png">

  <!-- Favicon -->
  <link rel="icon" type="image/png" href="favicon.png"/>

  <title>점심결정사</title>
  <link rel="manifest" href="manifest.json">
  <script 
    id="kakao-map-script"
    type="text/javascript" 
    src="https://dapi.kakao.com/v2/maps/sdk.js?appkey=e232b750f214ced5524f480a11662743&libraries=services,clusterer"
    onerror="window.handleScriptError()">
  </script>
  <script>
    window.handleScriptError = function() {
        console.error("Failed to load Kakao Map SDK script.");
    };

    window.initKakaoMap = function(elementId, lat, lng, markerName) {
      function tryInit(attempts) {
        if (attempts <= 0) {
            console.error("Failed to load Kakao Map SDK after multiple attempts.");
            return;
        }

        if (typeof kakao === 'undefined' || typeof kakao.maps === 'undefined') {
          setTimeout(function() { tryInit(attempts - 1); }, 200);
          return;
        }

        kakao.maps.load(function() {
            var container = document.getElementById(elementId);
            if (!container) return;

            try {
                var options = {
                    center: new kakao.maps.LatLng(lat, lng),
                    level: 3
                };
                var map = new kakao.maps.Map(container, options);
                
                // Force layout refresh after a moment
                setTimeout(function() {
                    map.relayout();
                    map.setCenter(new kakao.maps.LatLng(lat, lng));
                }, 500);

                var markerPosition  = new kakao.maps.LatLng(lat, lng); 
                var marker = new kakao.maps.Marker({
                    position: markerPosition
                });
                marker.setMap(map);

                if (markerName) {
                    var iwContent = '<div style="padding:5px; white-space:nowrap;">' + markerName + '</div>';
                    var infowindow = new kakao.maps.InfoWindow({
                        content : iwContent
                    });
                    infowindow.open(map, marker);
                }
            } catch (e) {
                console.error("Kakao Map init error: ", e);
            }
        });
      }
      
      tryInit(20); 
    }
  </script>
</head>
<body>
  <script src="flutter_bootstrap.js" async></script>
</body>
</html>
